<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<th:block th:fragment="variants_rows (productId, rows, optionNames)">
    <th:block th:with="
      c=${optionNames != null ? #lists.size(optionNames) : 0},
      n1=${c>=1 ? optionNames.get(0) : 'Option1'},
      n2=${c>=2 ? optionNames.get(1) : 'Option2'},
      n3=${c>=3 ? optionNames.get(2) : 'Option3'}
    ">
        <tr th:id="|variants-${productId}|">
            <td colspan="9" style="background:#fafafa">
                <table style="width:100%; border-collapse:collapse">
                    <thead>
                    <tr style="background:#f3f4f6">
                        <!-- 动态列头：最多三列 -->
                        <th style="padding:6px 8px" th:if="${c>=1}" th:text="${n1}">Option1</th>
                        <th style="padding:6px 8px" th:if="${c>=2}" th:text="${n2}">Option2</th>
                        <th style="padding:6px 8px" th:if="${c>=3}" th:text="${n3}">Option3</th>
                        <th style="padding:6px 8px">SKU</th>
                        <th style="padding:6px 8px">Price</th>
                        <th style="padding:6px 8px">Compare At Price</th>
                        <th style="padding:6px 8px">Available</th>
                        <th style="padding:6px 8px">Image</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="v : ${rows}">
                        <!-- 动态列值：对应 option1/2/3 -->
                        <td th:if="${c>=1}" th:text="${v.option1}">-</td>
                        <td th:if="${c>=2}" th:text="${v.option2}">-</td>
                        <td th:if="${c>=3}" th:text="${v.option3}">-</td>
                        <td th:text="${v.sku}">-</td>
                        <td th:text="${v.price != null ? #numbers.formatDecimal(v.price,1,'COMMA',2,'POINT') : '-'}">-
                        </td>
                        <td th:text="${v.comparePrice != null ? #numbers.formatDecimal(v.comparePrice,1,'COMMA',2,'POINT') : '-'}">
                            -
                        </td>
                        <td><span th:text="${v.available ? 'Yes' : 'No'}"></span></td>
                        <td>
                            <img th:if="${v.imageUrl != null}" th:src="${v.imageUrl}" class="thumb" alt="img"/>
                            <span class="muted" th:if="${v.imageUrl == null}">—</span>
                        </td>
                    </tr>
                    </tbody>
                </table>

                <div style="margin-top:8px">
                    <wa-button variant="neutral"
                               th:attr="onclick=|(()=>{const row=document.getElementById('variants-${productId}'); if(row) row.remove(); const btn=document.querySelector('.toggle-variants[data-pid=&quot;${productId}&quot;]'); if(btn){ btn.dataset.opened='false'; btn.textContent='Display variants'; }})()|">
                        Hide
                    </wa-button>
                </div>
            </td>
        </tr>
    </th:block>
</th:block>
</html>
